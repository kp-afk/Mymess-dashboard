# mymess.online Server Setup Guide

## Overview
This server runs on **AWS EC2 (Amazon Linux)** using **Nginx** as a web server.  
There is no Node/PM2 running — Nginx serves static files directly.  
The main app is a **Vite + React TSX** project that gets compiled into plain HTML/CSS/JS.

---

## Server Details
| Key | Value |
|-----|-------|
| EC2 IP | `43.204.13.122` |
| OS | Amazon Linux |
| Web Server | Nginx 1.28.2 |
| Project Location | `/home/ec2-user/Mymess-dashboard` |

---

## File Structure

```
/etc/nginx/
├── nginx.conf               ← Main Nginx config (don't touch this)
└── conf.d/
    └── mymess.conf          ← YOUR config — all domains/subdomains live here

/var/www/
├── mymess/                  ← Files served at mymess.online & www.mymess.online
│   └── (contents of dist/ after npm run build)
└── bhaskardogla/            ← Files served at bhaskardogla.mymess.online
    └── index.html (cloned from GitHub)

/home/ec2-user/
└── Mymess-dashboard/        ← Your React project source code
    ├── src/
    ├── dist/                ← Built output (generated by npm run build)
    └── package.json
```

---

## Current Domains

| Domain | Serves From | Type |
|--------|-------------|------|
| `mymess.online` | `/var/www/mymess` | Vite/React build |
| `www.mymess.online` | `/var/www/mymess` | Same as above |
| `bhaskardogla.mymess.online` | `/var/www/bhaskardogla` | Static HTML (GitHub) |

---

## How to Deploy Updates to mymess.online

```bash
cd ~/Mymess-dashboard
npm run build
sudo cp -r dist/* /var/www/mymess/
```

---

## How to Update bhaskardogla.mymess.online

```bash
cd /var/www/bhaskardogla
sudo git pull
```

---

## Adding a New Subdomain

### Step 1 — Add DNS Record
In your domain registrar, add an A record:
| Type | Name | Value |
|------|------|-------|
| A | `yoursubdomain` | `43.204.13.122` |

### Step 2 — Create a folder for its files
```bash
sudo mkdir -p /var/www/yoursubdomain
sudo chown -R nginx:nginx /var/www/yoursubdomain
```

### Step 3 — Add a server block to Nginx config
```bash
sudo nano /etc/nginx/conf.d/mymess.conf
```

Add this block at the bottom:
```nginx
server {
    listen 80;
    server_name yoursubdomain.mymess.online;

    root /var/www/yoursubdomain;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### Step 4 — Reload Nginx
```bash
sudo nginx -t && sudo systemctl reload nginx
```

### Step 5 — Add SSL
```bash
sudo certbot --nginx -d mymess.online -d www.mymess.online -d bhaskardogla.mymess.online -d yoursubdomain.mymess.online
```

> Always include ALL your domains when running certbot — it replaces the certificate each time.

---

## Removing a Subdomain

### Step 1 — Remove its server block
```bash
sudo nano /etc/nginx/conf.d/mymess.conf
```
Delete the entire `server { ... }` block for that subdomain.

### Step 2 — Delete its files
```bash
sudo rm -rf /var/www/yoursubdomain
```

### Step 3 — Reload Nginx
```bash
sudo nginx -t && sudo systemctl reload nginx
```

### Step 4 — Reissue SSL without it
```bash
sudo certbot --nginx -d mymess.online -d www.mymess.online -d bhaskardogla.mymess.online
```

### Step 5 — Delete the DNS record in your registrar

---

## Renaming a Subdomain

1. Add the new DNS A record in your registrar
2. Edit `/etc/nginx/conf.d/mymess.conf` — change the `server_name`
3. Rename or move the folder: `sudo mv /var/www/old /var/www/new`
4. Update the `root` path in the server block too
5. Reload: `sudo nginx -t && sudo systemctl reload nginx`
6. Reissue SSL with the new subdomain name
7. Delete the old DNS record

---

## Nginx Quick Reference

| Command | What it does |
|---------|-------------|
| `sudo nginx -t` | Test config for errors |
| `sudo systemctl reload nginx` | Apply config changes (no downtime) |
| `sudo systemctl restart nginx` | Full restart |
| `sudo systemctl status nginx` | Check if Nginx is running |
| `sudo tail -20 /var/log/nginx/error.log` | View recent errors |
| `sudo cat /etc/nginx/conf.d/mymess.conf` | View current domain config |

---

## SSL Certificates (Certbot)

Certificates are free via Let's Encrypt and auto-renew every 90 days.

**To add/update SSL for all domains:**
```bash
sudo certbot --nginx -d mymess.online -d www.mymess.online -d bhaskardogla.mymess.online
```

**Test auto-renewal:**
```bash
sudo certbot renew --dry-run
```

> ⚠️ Always list ALL domains when running certbot. Any domain left out will be removed from the certificate.

---

## Common Issues

**500 Internal Server Error** — Nginx can't read your files. Fix permissions:
```bash
sudo chown -R nginx:nginx /var/www/yourfolder
sudo chmod -R 755 /var/www/yourfolder
```

**403 Forbidden** — Folder exists but is empty or has no `index.html`. Add your files.

**ERR_CONNECTION_REFUSED** — Nginx isn't listening. Check config and reload:
```bash
sudo nginx -t && sudo systemctl reload nginx
sudo ss -tlnp | grep :80
```

**www not working** — DNS record missing or not propagated yet. Check registrar and wait up to 5 minutes (TTL 300).

**Config warnings on `nginx -t`** — Duplicate server blocks. Make sure the default server block is removed from `/etc/nginx/nginx.conf` and only your `conf.d/mymess.conf` defines the domains.
